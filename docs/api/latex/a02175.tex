

 layout\+: post title\+: Tests permalink\+: /about/tests \subsection*{category\+: about }

Testing is extremely important in the design of Fire. There are a lot of different types of tests in Fire and, more or less, \href{https://en.wikipedia.org/wiki/Test-driven_development}{\tt test driven development} drives the design of Fire.

Tests can be found in the $\ast$/tests$\ast$ subdirectory of any particular module of Fire. C\+Make\+Lists.\+txt files use the {\itshape tests.\+cmake} module in the {\itshape cmake} folder to configure and build tests.

\section*{Types of Tests}

Fire contains a lot of unit tests.

\section*{Running Tests}

Fire combines C\+Make\textquotesingle{}s testing system, C\+Test, and Boost\textquotesingle{}s Unit Testing Framework for testing.

You can run the tests in Fire in your build directory after the build by simply executing


\begin{DoxyCode}
make test
\end{DoxyCode}


Since Fire\textquotesingle{}s build system is built on cmake, you can also execute the tests using ctest. For example, you can execute


\begin{DoxyCode}
ctest
\end{DoxyCode}


You can also run individual tests manually. For example, you can run a test in the astrophysics module like so, assuming you start in your build directory,


\begin{DoxyCode}
cd astrophysics
./myTest
\end{DoxyCode}


\subsubsection*{Where to run?}

All tests in fire are written to run from the directory where they are built, not the top-\/level build directory. For example, all astrophysics tests should be run from the astrophysics directory, all parser tests should be run from the parsers directory, etc. This makes it possible for the test code to very simply interact with test data files without any special requirements for finding those test data files.

The custom C\+Make code in Fire that generates your test (see cmake/tests.\+cmake), configures ctest so that when you run it from the build directory it secretly executes in the appropriate subdirectory. So, if you run \char`\"{}make test,\char`\"{} the build quietly changes into the appropriate directory to run the test. Make sure that you follow the third example above for manually running your test in the proper directory if you need to run individual tests.

\subsubsection*{Executing By Label}

You can run subsets of Fire\textquotesingle{}s tests by passing the labels of the tests that you want to run to ctest. The following command will execute all of the \char`\"{}astrophysics\char`\"{} tests in Fire.


\begin{DoxyCode}
ctest -L FireAstro
\end{DoxyCode}


The valid labels are the C\+Make module names defined for each packaged in its C\+Make\+Lists.\+txt file.

\subsubsection*{On N\+Vidia Optimus Cards with Linux}

N\+Vidia\textquotesingle{}s Optimus Technology requires special care and feeding on Linux. If you have this setup and your system is configure correctly, you need only modify the above command by adding the \char`\"{}optirun\char`\"{} prefix


\begin{DoxyCode}
optirun make test
\end{DoxyCode}


If you do not use this command, you may see segmentation faults or other errors. The alternative to optirun, called \char`\"{}primusrun,\char`\"{} may or may not work. (Sometimes it works for the author and sometimes it doesn\textquotesingle{}t.)

\section*{Verbose Output}

Boost unit tests do not print all of their output by default. Neither does ctest. This makes debugging with stdout difficult! The level of output is controlled by environment variables that must be set before the tests run. For example, running a test without this variable will look something like


\begin{DoxyCode}
$ ./DelimitedTextParserTest 
Running 2 test cases...

*** No errors detected
\end{DoxyCode}
 but running it with the log level set to \char`\"{}all\char`\"{} will have different output,


\begin{DoxyCode}
BOOST\_TEST\_LOG\_LEVEL=all ./DelimitedTextParserTest 
Running 2 test cases...
Entering test suite "Parsers"
Entering test case "checkCSV"
Configuring fixture.
Fixture configured.
fire/parsers/tests/DelimitedTextParserTest.cpp(94): info: check 3 == data.size() passed
fire/parsers/tests/DelimitedTextParserTest.cpp(96): info: check 3 == dataEntry.size() passed

...

fire/parsers/tests/DelimitedTextParserTest.cpp(114): info: check 8729.9 == dataEntry[3] passed
Leaving test case "checkCSV"; testing time: 1005mks
Entering test case "checkSpace"
Leaving test case "checkSpace"; testing time: 805mks
Leaving test suite "Parsers"

*** No errors detected
\end{DoxyCode}


Detailed information on the log levels of the Boost Unit Testing Framework are available on their \href{http://www.boost.org/doc/libs/1_34_1/libs/test/doc/components/utf/parameters/log_level.html}{\tt log level parameter page}.

To get ctest to display all of this information, the C\+T\+E\+S\+T\+\_\+\+O\+U\+T\+P\+U\+T\+\_\+\+O\+N\+\_\+\+F\+A\+I\+L\+U\+RE flag can be combined with the B\+O\+O\+ST log level to display all the information


\begin{DoxyCode}
CTEST\_OUTPUT\_ON\_FAILURE=1 BOOST\_TEST\_LOG\_LEVEL=all make test
\end{DoxyCode}
 