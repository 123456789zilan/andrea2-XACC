<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>XACC: 2016-10-30-tests</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">XACC
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">2016-10-30-tests </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><hr/>
<p> layout: post title: Tests permalink: /about/tests </p><h2>category: about </h2>
<p>Testing is extremely important in the design of Fire. There are a lot of different types of tests in Fire and, more or less, <a href="https://en.wikipedia.org/wiki/Test-driven_development">test driven development</a> drives the design of Fire.</p>
<p>Tests can be found in the */tests* subdirectory of any particular module of Fire. CMakeLists.txt files use the <em>tests.cmake</em> module in the <em>cmake</em> folder to configure and build tests.</p>
<h1>Types of Tests</h1>
<p>Fire contains a lot of unit tests.</p>
<h1>Running Tests</h1>
<p>Fire combines CMake's testing system, CTest, and Boost's Unit Testing Framework for testing.</p>
<p>You can run the tests in Fire in your build directory after the build by simply executing</p>
<div class="fragment"><div class="line">make test</div></div><!-- fragment --><p>Since Fire's build system is built on cmake, you can also execute the tests using ctest. For example, you can execute</p>
<div class="fragment"><div class="line">ctest</div></div><!-- fragment --><p>You can also run individual tests manually. For example, you can run a test in the astrophysics module like so, assuming you start in your build directory,</p>
<div class="fragment"><div class="line">cd astrophysics</div><div class="line">./myTest</div></div><!-- fragment --><h3>Where to run?</h3>
<p>All tests in fire are written to run from the directory where they are built, not the top-level build directory. For example, all astrophysics tests should be run from the astrophysics directory, all parser tests should be run from the parsers directory, etc. This makes it possible for the test code to very simply interact with test data files without any special requirements for finding those test data files.</p>
<p>The custom CMake code in Fire that generates your test (see cmake/tests.cmake), configures ctest so that when you run it from the build directory it secretly executes in the appropriate subdirectory. So, if you run "make test," the build quietly changes into the appropriate directory to run the test. Make sure that you follow the third example above for manually running your test in the proper directory if you need to run individual tests.</p>
<h3>Executing By Label</h3>
<p>You can run subsets of Fire's tests by passing the labels of the tests that you want to run to ctest. The following command will execute all of the "astrophysics" tests in Fire.</p>
<div class="fragment"><div class="line">ctest -L FireAstro</div></div><!-- fragment --><p>The valid labels are the CMake module names defined for each packaged in its CMakeLists.txt file.</p>
<h3>On NVidia Optimus Cards with Linux</h3>
<p>NVidia's Optimus Technology requires special care and feeding on Linux. If you have this setup and your system is configure correctly, you need only modify the above command by adding the "optirun" prefix</p>
<div class="fragment"><div class="line">optirun make test</div></div><!-- fragment --><p>If you do not use this command, you may see segmentation faults or other errors. The alternative to optirun, called "primusrun," may or may not work. (Sometimes it works for the author and sometimes it doesn't.)</p>
<h1>Verbose Output</h1>
<p>Boost unit tests do not print all of their output by default. Neither does ctest. This makes debugging with stdout difficult! The level of output is controlled by environment variables that must be set before the tests run. For example, running a test without this variable will look something like</p>
<div class="fragment"><div class="line">$ ./DelimitedTextParserTest </div><div class="line">Running 2 test cases...</div><div class="line"></div><div class="line">*** No errors detected</div></div><!-- fragment --><p> but running it with the log level set to "all" will have different output,</p>
<div class="fragment"><div class="line">BOOST_TEST_LOG_LEVEL=all ./DelimitedTextParserTest </div><div class="line">Running 2 test cases...</div><div class="line">Entering test suite &quot;Parsers&quot;</div><div class="line">Entering test case &quot;checkCSV&quot;</div><div class="line">Configuring fixture.</div><div class="line">Fixture configured.</div><div class="line">fire/parsers/tests/DelimitedTextParserTest.cpp(94): info: check 3 == data.size() passed</div><div class="line">fire/parsers/tests/DelimitedTextParserTest.cpp(96): info: check 3 == dataEntry.size() passed</div><div class="line"></div><div class="line">...</div><div class="line"></div><div class="line">fire/parsers/tests/DelimitedTextParserTest.cpp(114): info: check 8729.9 == dataEntry[3] passed</div><div class="line">Leaving test case &quot;checkCSV&quot;; testing time: 1005mks</div><div class="line">Entering test case &quot;checkSpace&quot;</div><div class="line">Leaving test case &quot;checkSpace&quot;; testing time: 805mks</div><div class="line">Leaving test suite &quot;Parsers&quot;</div><div class="line"></div><div class="line">*** No errors detected</div></div><!-- fragment --><p>Detailed information on the log levels of the Boost Unit Testing Framework are available on their <a href="http://www.boost.org/doc/libs/1_34_1/libs/test/doc/components/utf/parameters/log_level.html">log level parameter page</a>.</p>
<p>To get ctest to display all of this information, the CTEST_OUTPUT_ON_FAILURE flag can be combined with the BOOST log level to display all the information</p>
<div class="fragment"><div class="line">CTEST_OUTPUT_ON_FAILURE=1 BOOST_TEST_LOG_LEVEL=all make test</div></div><!-- fragment --> </div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
