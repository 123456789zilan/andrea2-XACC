<!-- HTML header for doxygen 1.8.8-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <!-- For Mobile Devices -->
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
        <meta name="generator" content="Doxygen 1.8.11"/>
        <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
        <title>XACC: 2016-11-14-builders</title>
        <link href="tabs.css" rel="stylesheet" type="text/css"/>
        <script type="text/javascript" src="dynsections.js"></script>
        <link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
        <link href="doxygen.css" rel="stylesheet" type="text/css" />
        <link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
        <link href='https://fonts.googleapis.com/css?family=Roboto+Slab' rel='stylesheet' type='text/css'>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css">
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/js/bootstrap.min.js"></script>
        <script type="text/javascript" src="doxy-boot.js"></script>
    </head>
    <body>
        <nav class="navbar navbar-default" role="navigation">
            <div class="container">
                <div class="navbar-header">
                    <a class="navbar-brand">XACC </a>
                </div>
            </div>
        </nav>
        <div id="top"><!-- do not remove this div, it is closed by doxygen! -->
            <div class="content" id="content">
                <div class="container">
                    <div class="row">
                        <div class="col-sm-12 panel " style="padding-bottom: 15px;">
                            <div style="margin-bottom: 15px;">
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">2016-11-14-builders </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><hr/>
<p> layout: post title: Builders permalink: /design/builders </p><h2>category: design </h2>
<p>Objects in Fire should be constructed using developer-provided specializations of the build&lt;T&gt;() template function, which is described in <a class="el" href="a00394_source.html">build.h</a>.</p>
<p>Object construction can be problematic in software projects if the method of initializing those objects changes. For example, it may be sufficient to initialize an object with the following:</p>
<div class="fragment"><div class="line">MyCustomClass object; <span class="comment">// Nullary constructor</span></div><div class="line">MyCustomClass copiedObject(<span class="keywordtype">object</span>); <span class="comment">// Copy constructor</span></div><div class="line">MyCustomClass otherObject(5); <span class="comment">// Special constructor that does something else.</span></div></div><!-- fragment --><p>What happens if the design of <em>MyCustomClass</em> changes so that a special <em>initialize</em> operation must be called after the constructor? Or what if data members need to be filled? Then initialization would look like this:</p>
<div class="fragment"><div class="line">MyCustomClass object(5); <span class="comment">// Pass a special argument</span></div><div class="line"><span class="keywordtype">object</span>.setX(x); <span class="comment">// Set some data</span></div><div class="line"><span class="keywordtype">object</span>.setY(y);</div><div class="line"><span class="keywordtype">object</span>.init(); <span class="comment">// Initialize the object for some long-running work after construction</span></div></div><!-- fragment --><p>This quickly becomes troublesome if <em>MyCustomClass</em> is used in many places because it requires a lot of code and could lead to bugs. Thus, Fire uses a templated "builder" function to construct objects like so</p>
<div class="fragment"><div class="line"><span class="keyword">auto</span> <span class="keywordtype">object</span> = build&lt;MyCustomClass&gt;(); <span class="comment">// Default construction</span></div><div class="line"><span class="keyword">auto</span> otherObject = build&lt;MyCustomClass&gt;(5,x,y); <span class="comment">// Initialized with data</span></div></div><!-- fragment --><p>where the build&lt;T&gt;() template is specialized by the developer specifically for constructing MyCustomClass in appropriate ways. This eliminates the details of exactly how MyCustomClass is constructed and additionally avoids the "pollution" of duplicating the code to construct MyCustomClass every it is used. Different versions of build&lt;T&gt;() exist, including versions for instantiation by lists and other input arguments; both versions in the code sample above are valid.</p>
<p>The cleanest way to provide specializations of build&lt;T&gt;() for any class is after the class in the header file where the class is defined.</p>
<p>The build&lt;T&gt;() template function is currently defined in <a class="el" href="a00394_source.html">build.h</a> in the parsers module, but may move in the future.</p>
<h2>Example</h2>
<p>The <a class="el" href="a00678_source.html">Reaction.h</a> file in the astrophysics module has a good examples of providing a specialization of build&lt;T&gt;(). The only catch is that build&lt;T&gt;() specializations must be created in the <em>fire</em> namespace, not a subspace.</p>
<p><a class="el" href="a00741_source.html">SpeciesLocalParser.h</a> shows a good example of "implicit instantiation" for the build&lt;T&gt;() function for the Species class. In this case, the compiler automatically creates the specialized version of build&lt;T&gt;() based on type inference and the second version of build&lt;T&gt;() in <a class="el" href="a00394_source.html">build.h</a>.</p>
<h2>build&lt;T&gt;() vs parse&lt;T&gt;()</h2>
<p>In some cases the build&lt;T&gt;() can be grammatically cumbersome. Consider the following example:</p>
<div class="fragment"><div class="line"><span class="keyword">auto</span> parser = build&lt;LocalParser&lt;vector&lt;T&gt;&gt;, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp;&gt;(fileName);</div><div class="line">parser.parse();</div><div class="line"><span class="keyword">auto</span> myData = speciesParser.getData();</div></div><!-- fragment --><p>The problem with this code is that it is essentially the same thing as what build&lt;T&gt;() is meant to prevent - bloat that will be copied everywhere! The worst part of the bloat is the template arguments, which are most likely constant across many different parsers. It is better to use parse&lt;T&gt;() in cases like this, which looks like the following:</p>
<div class="fragment"><div class="line"><span class="keyword">auto</span> myData = parse&lt;T&gt;(filename);</div></div><!-- fragment --><p>parse&lt;T&gt;() is specifically designed for returning vectors of type T from local files. It isn't a substitute for complex parsers, but it saves a lot of effort for regular, block-structured data.</p>
<p>The two major differences between these two methods are</p>
<ul>
<li>Code cleanliness</li>
<li>parse&lt;T&gt;() automatically parses the file, whereas build&lt;T&gt;() probably does and should not.</li>
</ul>
<p>The second point is really important. Should your build&lt;T&gt;() parse as well as build? That's a design issue that we'll defer for now, but keep in mind that if your build&lt;T&gt;() routine parses, then your clients should not use parse&lt;T&gt;() because it calls build&lt;T&gt;() too, which means your data will be loaded twice into the same array! This is the reason that default build&lt;T&gt;() implementations for local parsers in Fire <b>never</b> call parser.parse().</p>
<h3>Author note</h3>
<p>Note: Ideally the default version of build would work for variadic template and function arguments, but at the specific function must be implemented. </p>
</div></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.8-->
<!-- start footer part -->
</div>
</div>
</div>
</div>
</div>
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
